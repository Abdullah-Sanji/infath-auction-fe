version: "3.8"

services:
  frontend-dev:
    image: node:20-alpine
    container_name: azm-auctions-frontend-dev
    working_dir: /app
    volumes:
      - ./:/app:cached
      - /app/node_modules
      - ./ssl:/app/ssl:ro
    environment:
      - CHOKIDAR_USEPOLLING=true
    ports:
      - "4200:4200"
    command: sh -c "corepack enable && corepack prepare pnpm@10.25.0 --activate && pnpm install && pnpm start"
    stdin_open: true
    tty: true

  ssr:
    build:
      context: .
      target: runner
    container_name: azm-auctions-ssr
    working_dir: /app
    volumes:
      - ./ssl:/app/ssl:ro
    environment:
      - NODE_ENV=development
      - PORT=4000
    ports:
      - "4000:4000"
    command: ["node", "dist/auctions-frontend/server/server.mjs"]
